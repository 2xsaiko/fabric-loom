apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'maven'
apply plugin: 'maven-publish'
apply plugin: 'idea'

group = 'chorusmc.gradle'
version = '0.0.1'
sourceCompatibility = targetCompatibility = '1.8'

if (System.getenv().BUILD_NUMBER) {
    version = version + "." + "${System.getenv().BUILD_NUMBER}"
}

repositories {
    mavenCentral()
    flatDir {
        dirs 'libs'
    }
    ivy {
        name "Enigma-Temporary"
        artifactPattern "http://modmuss50.me:8080/job/Enigma-Asie/lastSuccessfulBuild/artifact/build/libs/[module]-[revision]-[classifier].[ext]"
    }
}

configurations {
    deployerJars
    shade
    compile.extendsFrom shade
}

dependencies {
    compile gradleApi()
    shade 'org.zeroturnaround:zt-zip:1.9'
    compile 'org.slf4j:slf4j-api:1.7.21'
    compile 'org.slf4j:slf4j-simple:1.7.21'
    shade 'com.google.code.gson:gson:2.6.2'
    shade 'com.googlecode.java-diff-utils:diffutils:1.3.0'
    shade 'com.cloudbees:diff4j:1.2'
    shade 'commons-io:commons-io:1.4'
    shade 'com.google.guava:guava-jdk5:17.0'
    shade 'org.ow2.asm:asm-debug-all:5.0.3'
    shade 'com.google.guava:guava:19.0'
    shade name: "enigma", version: "0.11.0.6", classifier: "all"
}

sourceSets {
    main.compileClasspath += configurations.shade;
    main.runtimeClasspath += configurations.shade;
    test.compileClasspath += configurations.shade;
    test.runtimeClasspath += configurations.shade;
}

jar {
    configurations.shade.each { dep ->
        from(project.zipTree(dep)) {
            exclude 'META-INF', 'META-INF/**'
        }
    }
}

//TODO maven uploading
